<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghar Ka Khana Guru | ‡§ò‡§∞ ‡§ï‡§æ ‡§ñ‡§æ‡§®‡§æ ‡§ó‡•Å‡§∞‡•Å</title>
    
    <!-- Google Fonts: Mukta for excellent Devanagari/Latin support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --saffron: #FF9933;
            --turmeric: #FFC107;
            --chili: #D32F2F;
            --leaf: #388E3C;
            --cream: #FFF8E1;
            --dark: #333333;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.1);
            --font-main: 'Mukta', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main);
            background-color: var(--cream);
            color: var(--dark);
            line-height: 1.6;
            /* Subtle pattern */
            background-image: radial-gradient(circle, #e6dcb8 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- Header --- */
        header {
            background: linear-gradient(135deg, var(--saffron), var(--chili));
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: 'üïâÔ∏è';
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 5rem;
            opacity: 0.1;
        }

        header::after {
            content: 'ü•ò';
            position: absolute;
            bottom: -10px;
            right: -10px;
            font-size: 5rem;
            opacity: 0.1;
        }

        h1 {
            font-weight: 800;
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            font-size: 1.1rem;
            font-weight: 300;
            opacity: 0.95;
        }

        /* --- Layout Containers --- */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* --- API Key Section --- */
        .api-section {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: var(--chili);
            font-weight: 600;
        }

        .api-content {
            display: none;
            margin-top: 1rem;
            border-top: 1px dashed #ccc;
            padding-top: 1rem;
        }

        .api-content.show { display: block; }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .btn-small {
            background: var(--leaf);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* --- Ingredients Grid --- */
        .pantry-section {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        .category-title {
            color: var(--saffron);
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 2px solid var(--cream);
            padding-bottom: 5px;
        }
        
        .category-title:first-of-type { margin-top: 0; }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .ing-checkbox {
            display: none;
        }

        .ing-label {
            display: block;
            background: #f9f9f9;
            border: 1px solid #eee;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .ing-label:hover {
            background: var(--cream);
        }

        .ing-checkbox:checked + .ing-label {
            background: var(--leaf);
            color: white;
            border-color: var(--leaf);
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(56, 142, 60, 0.3);
        }

        .ing-checkbox:checked + .ing-label::after {
            content: '‚úî';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
        }

        /* --- Action Button --- */
        .cook-btn-container {
            position: sticky;
            bottom: 20px;
            text-align: center;
            margin-top: 20px;
            z-index: 100;
        }

        .cook-btn {
            background: linear-gradient(to right, var(--chili), #b71c1c);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(211, 47, 47, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .cook-btn:active { transform: scale(0.95); }
        .cook-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* --- Results --- */
        #results-area {
            margin-top: 2rem;
        }

        .recipe-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--turmeric);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dish-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .dish-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--chili);
        }

        .dish-meta {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            display: flex;
            gap: 15px;
        }

        .recipe-step {
            margin-bottom: 8px;
            padding-left: 15px;
            position: relative;
        }

        .recipe-step::before {
            content: '‚Ä¢';
            color: var(--saffron);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .why-it-works {
            margin-top: 1rem;
            background: var(--cream);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-style: italic;
            color: #5d4037;
        }

        .card-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--saffron);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- About & Footer --- */
        .about-section {
            margin-top: 3rem;
            background: #fff3e0;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #ffe0b2;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 0.9rem;
        }

        @media (min-width: 600px) {
            .ingredient-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
        }
    </style>
</head>
<body>

<header>
    <h1>‡§ò‡§∞ ‡§ï‡§æ ‡§ñ‡§æ‡§®‡§æ ‡§ó‡•Å‡§∞‡•Å <br><span style="font-size: 0.7em;">Ghar Ka Khana Guru</span></h1>
    <p class="tagline">‡§¨‡§ø‡§®‡§æ ‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§ó‡§è, ‡§ú‡•ã ‡§ò‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡•à ‡§â‡§∏‡•Ä ‡§∏‡•á ‡§∏‡•ç‡§µ‡§æ‡§¶‡§ø‡§∑‡•ç‡§ü ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§® ‡§¨‡§®‡§æ‡§á‡§è üè†ü•ò</p>
</header>

<div class="container">

    <!-- API Key Section -->
    <div class="api-section">
        <div class="api-header" onclick="toggleApi()">
            <span>‚öôÔ∏è Google Gemini API Setup (Optional for AI Magic)</span>
            <span id="api-arrow">‚ñº</span>
        </div>
        <div class="api-content" id="api-content">
            <p>To get smart, unlimited suggestions, get a free API key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</p>
            <p><i>If you don't enter a key, we will show a list of classic fallback recipes!</i></p>
            <br>
            <input type="text" id="apiKeyInput" placeholder="Paste API Key here (begins with AIza...)">
            <button class="btn-small" onclick="saveApiKey()">Save Key</button>
            <span id="key-status" style="margin-left: 10px; color: green;"></span>
        </div>
    </div>

    <!-- Ingredients Selection -->
    <div class="pantry-section" id="pantry-ui">
        <p style="text-align:center; margin-bottom:20px; color:#666;">Tick whatever you have in your kitchen right now üëá</p>
        <!-- Content generated by JS -->
    </div>

    <!-- Action Button -->
    <div class="cook-btn-container">
        <button class="cook-btn" onclick="generateRecipes()">
            <span>üë©‚Äçüç≥ ‡§Æ‡•Å‡§ù‡•á ‡§¨‡§§‡§æ‡§ì ‡§ï‡•ç‡§Ø‡§æ ‡§¨‡§®‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</span>
            <span style="font-size: 0.8em; font-weight:400;">(Tell me what I can make)</span>
        </button>
    </div>

    <!-- Loading -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <h3>Asking Dadi Ma... (Thinking)</h3>
        <p>‡§ó‡§∞‡§Æ‡§æ ‡§ó‡§∞‡§Æ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§™‡§ï ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</p>
    </div>

    <!-- Results -->
    <div id="results-area"></div>

    <!-- About -->
    <div class="about-section">
        <h3>üå∂Ô∏è The Magic of Indian Pantry</h3>
        <p>Indian cooking is the art of adaptability. With just a simple tadka (tempering) of jeera and rai, plain dal transforms into a delicacy. This app tries to replicate that wisdom‚Äîusing common staples like Besan, Sooji, and seasonal veggies to create magic without needing a grocery run.</p>
    </div>

    <footer>
        Made with ‚ù§Ô∏è & üçõ by Sam J. Jam.<br>
        Pure JavaScript. No tracking. LocalStorage only. 
    </footer>

</div>

<script>
    // --- 1. DATA: Ingredients List ---
    const pantryCategories = [
        {
            name: "ü•î Vegetables & Fresh (‡§∏‡§¨‡•ç‡§ú‡§ø‡§Ø‡§æ‡§Ç)",
            items: [
                {id: "onion", en: "Onion", hi: "‡§™‡•ç‡§Ø‡§æ‡§ú‡§º"},
                {id: "potato", en: "Potato", hi: "‡§Ü‡§≤‡•Ç"},
                {id: "tomato", en: "Tomato", hi: "‡§ü‡§Æ‡§æ‡§ü‡§∞"},
                {id: "ginger", en: "Ginger", hi: "‡§Ö‡§¶‡§∞‡§ï"},
                {id: "garlic", en: "Garlic", hi: "‡§≤‡§π‡§∏‡•Å‡§®"},
                {id: "greenchili", en: "Green Chili", hi: "‡§π‡§∞‡•Ä ‡§Æ‡§ø‡§∞‡•ç‡§ö"},
                {id: "coriander", en: "Coriander Leaves", hi: "‡§ß‡§®‡§ø‡§Ø‡§æ ‡§™‡§§‡•ç‡§§‡§æ"},
                {id: "lemon", en: "Lemon", hi: "‡§®‡•Ä‡§Ç‡§¨‡•Ç"},
                {id: "peas", en: "Green Peas", hi: "‡§Æ‡§ü‡§∞"},
                {id: "cauliflower", en: "Cauliflower", hi: "‡§ó‡•ã‡§≠‡•Ä"},
                {id: "cabbage", en: "Cabbage", hi: "‡§™‡§§‡•ç‡§§‡§æ ‡§ó‡•ã‡§≠‡•Ä"},
                {id: "brinjal", en: "Brinjal/Eggplant", hi: "‡§¨‡•à‡§Ç‡§ó‡§®"},
                {id: "bhindi", en: "Okra", hi: "‡§≠‡§ø‡§Ç‡§°‡•Ä"},
                {id: "carrot", en: "Carrot", hi: "‡§ó‡§æ‡§ú‡§∞"},
                {id: "capsicum", en: "Capsicum", hi: "‡§∂‡§ø‡§Æ‡§≤‡§æ ‡§Æ‡§ø‡§∞‡•ç‡§ö"},
                {id: "spinach", en: "Spinach/Palak", hi: "‡§™‡§æ‡§≤‡§ï"}
            ]
        },
        {
            name: "üç≤ Dals & Pulses (‡§¶‡§æ‡§≤‡•á‡§Ç)",
            items: [
                {id: "toordal", en: "Toor/Arhar Dal", hi: "‡§§‡•Ç‡§∞ ‡§¶‡§æ‡§≤"},
                {id: "moongdal", en: "Moong Dal (Yellow)", hi: "‡§Æ‡•Ç‡§Ç‡§ó ‡§¶‡§æ‡§≤ (‡§™‡•Ä‡§≤‡•Ä)"},
                {id: "moongchilka", en: "Moong (Green)", hi: "‡§Æ‡•Ç‡§Ç‡§ó (‡§õ‡§ø‡§≤‡§ï‡§æ)"},
                {id: "masoor", en: "Masoor Dal", hi: "‡§Æ‡§∏‡•Ç‡§∞ ‡§¶‡§æ‡§≤"},
                {id: "chanadal", en: "Chana Dal", hi: "‡§ö‡§®‡§æ ‡§¶‡§æ‡§≤"},
                {id: "uraddal", en: "Urad Dal", hi: "‡§â‡§°‡§º‡§¶ ‡§¶‡§æ‡§≤"},
                {id: "chole", en: "Chickpeas/Chole", hi: "‡§ï‡§æ‡§¨‡•Å‡§≤‡•Ä ‡§ö‡§®‡§æ"},
                {id: "rajma", en: "Kidney Beans", hi: "‡§∞‡§æ‡§ú‡§Æ‡§æ"},
                {id: "besan", en: "Besan/Gram Flour", hi: "‡§¨‡•á‡§∏‡§®"}
            ]
        },
        {
            name: "üåæ Grains & Flours (‡§Ö‡§®‡§æ‡§ú)",
            items: [
                {id: "rice", en: "Rice", hi: "‡§ö‡§æ‡§µ‡§≤"},
                {id: "atta", en: "Wheat Flour", hi: "‡§Ü‡§ü‡§æ"},
                {id: "maida", en: "Maida", hi: "‡§Æ‡•à‡§¶‡§æ"},
                {id: "sooji", en: "Sooji/Rava", hi: "‡§∏‡•Ç‡§ú‡•Ä"},
                {id: "poha", en: "Poha", hi: "‡§™‡•ã‡§π‡§æ"},
                {id: "vermicelli", en: "Semiya/Vermicelli", hi: "‡§∏‡•á‡§µ‡§à"},
                {id: "oats", en: "Oats", hi: "‡§ì‡§ü‡•ç‡§∏"},
                {id: "bread", en: "Bread", hi: "‡§¨‡•ç‡§∞‡•á‡§°"}
            ]
        },
        {
            name: "ü•õ Dairy & Fats (‡§°‡•á‡§Ø‡§∞‡•Ä)",
            items: [
                {id: "milk", en: "Milk", hi: "‡§¶‡•Ç‡§ß"},
                {id: "curd", en: "Curd/Yogurt", hi: "‡§¶‡§π‡•Ä"},
                {id: "ghee", en: "Ghee", hi: "‡§ò‡•Ä"},
                {id: "paneer", en: "Paneer", hi: "‡§™‡§®‡•Ä‡§∞"},
                {id: "butter", en: "Butter", hi: "‡§Æ‡§ï‡•ç‡§ñ‡§®"},
                {id: "malai", en: "Cream/Malai", hi: "‡§Æ‡§≤‡§æ‡§à"}
            ]
        },
        {
            name: "üå∂Ô∏è Spices (‡§Æ‡§∏‡§æ‡§≤‡•á)",
            items: [
                {id: "jeera", en: "Cumin/Jeera", hi: "‡§ú‡•Ä‡§∞‡§æ"},
                {id: "rai", en: "Mustard Seeds/Rai", hi: "‡§∞‡§æ‡§à/‡§∏‡§∞‡§∏‡•ã‡§Ç"},
                {id: "haldi", en: "Turmeric", hi: "‡§π‡§≤‡•ç‡§¶‡•Ä"},
                {id: "redchili", en: "Red Chili Powder", hi: "‡§≤‡§æ‡§≤ ‡§Æ‡§ø‡§∞‡•ç‡§ö"},
                {id: "dhania", en: "Coriander Powder", hi: "‡§ß‡§®‡§ø‡§Ø‡§æ ‡§™‡§æ‡§â‡§°‡§∞"},
                {id: "garammasala", en: "Garam Masala", hi: "‡§ó‡§∞‡§Æ ‡§Æ‡§∏‡§æ‡§≤‡§æ"},
                {id: "hing", en: "Asafoetida", hi: "‡§π‡•Ä‡§Ç‡§ó"},
                {id: "wholespices", en: "Whole Spices (Khada Masala)", hi: "‡§ñ‡§°‡§º‡•á ‡§Æ‡§∏‡§æ‡§≤‡•á"},
                {id: "kasurimethi", en: "Kasuri Methi", hi: "‡§ï‡§∏‡•Ç‡§∞‡•Ä ‡§Æ‡•á‡§•‡•Ä"},
                {id: "amchur", en: "Dry Mango Powder", hi: "‡§Ü‡§Æ‡§ö‡•Ç‡§∞"}
            ]
        },
        {
            name: "ü•• Misc (‡§Ö‡§®‡•ç‡§Ø)",
            items: [
                {id: "sugar", en: "Sugar", hi: "‡§ö‡•Ä‡§®‡•Ä"},
                {id: "jaggery", en: "Jaggery", hi: "‡§ó‡•Å‡§°‡§º"},
                {id: "peanuts", en: "Peanuts", hi: "‡§Æ‡•Ç‡§Ç‡§ó‡§´‡§≤‡•Ä"},
                {id: "coconut", en: "Coconut", hi: "‡§®‡§æ‡§∞‡§ø‡§Ø‡§≤"},
                {id: "tamarind", en: "Tamarind", hi: "‡§á‡§Æ‡§≤‡•Ä"}
            ]
        }
    ];

    // --- 2. STATIC FALLBACK RECIPES (If API fails or no key) ---
    const fallbackRecipes = [
        {
            "name": "Classic Masala Khichdi (‡§Æ‡§∏‡§æ‡§≤‡§æ ‡§ñ‡§ø‡§ö‡§°‡§º‡•Ä)",
            "region": "All India",
            "time": "20 mins",
            "desc": "Comfort food made with rice, moong dal, and available veggies.",
            "recipe": [
                "Wash mix of Rice and Moong Dal.",
                "Heat Ghee/Oil in cooker. Add Jeera, Hing, Onions, Tomatoes, Green Chili.",
                "Add any veggies you have (Peas, Potato, Gobhi).",
                "Add Haldi, Salt, Chili powder. Saut√©.",
                "Add rice-dal mix and 3x water. Whistle 3-4 times.",
                "‡§ó‡§∞‡§Æ‡§æ ‡§ó‡§∞‡§Æ ‡§ò‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§∞‡•ã‡§∏‡•á‡§Ç‡•§"
            ]
        },
        {
            "name": "Jeera Aloo (‡§ú‡•Ä‡§∞‡§æ ‡§Ü‡§≤‡•Ç)",
            "region": "North India",
            "time": "15 mins",
            "desc": "Simple, spicy potatoes that go great with Roti or Dal.",
            "recipe": [
                "Boil Potatoes and cut into cubes.",
                "Heat Oil. Add lots of Jeera (Cumin) and Hing.",
                "Add Green Chilies, Haldi, Coriander powder.",
                "Toss potatoes in spices until coated and slightly crispy.",
                "Finish with Amchur and fresh Dhania leaves."
            ]
        },
        {
            "name": "Besan Chilla (‡§¨‡•á‡§∏‡§® ‡§ö‡§ø‡§≤‡•ç‡§≤‡§æ)",
            "region": "North/West India",
            "time": "10 mins",
            "desc": "Instant protein-rich pancakes. Perfect for breakfast.",
            "recipe": [
                "Mix Besan, water, salt, Haldi, Ajwain (if avail) to make flowing batter.",
                "Add chopped Onions, Tomatoes, Chilies, Coriander.",
                "Heat tawa, brush oil. Pour ladleful of batter.",
                "Cook both sides until golden brown.",
                "Serve with Chutney or Ketchup."
            ]
        },
        {
            "name": "Kanda Poha (‡§ï‡§æ‡§Ç‡§¶‡§æ ‡§™‡•ã‡§π‡§æ)",
            "region": "Maharashtra",
            "time": "15 mins",
            "desc": "Flattened rice stir-fry.",
            "recipe": [
                "Rinse Poha in colander and let it drain.",
                "Fry Peanuts in oil, keep aside.",
                "In same oil, add Rai, Jeera, Curry leaves (if avail), Onions, Chilies.",
                "Add Turmeric and Salt. Add drained Poha.",
                "Mix gently. Add fried peanuts, Lemon juice, Sugar (pinch). Steam for 2 mins."
            ]
        },
        {
            "name": "Dal Tadka (‡§¶‡§æ‡§≤ ‡§§‡§°‡§º‡§ï‡§æ)",
            "region": "Pan India",
            "time": "25 mins",
            "desc": "Restaurant style yellow dal at home.",
            "recipe": [
                "Boil Toor/Moong dal with Haldi and Salt.",
                "In a separate small pan, heat Ghee.",
                "Add Jeera, Garlic (chopped), Dried Red Chili, Hing.",
                "Add Kashmiri Red Chili powder (for color) and immediately pour over boiled Dal.",
                "Garnish with Coriander."
            ]
        }
    ];

    // --- 3. UI GENERATION ---
    function renderPantry() {
        const container = document.getElementById('pantry-ui');
        
        pantryCategories.forEach(cat => {
            // Header
            const header = document.createElement('div');
            header.className = 'category-title';
            header.innerHTML = cat.name;
            container.appendChild(header);

            // Grid
            const grid = document.createElement('div');
            grid.className = 'ingredient-grid';

            cat.items.forEach(item => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="checkbox" class="ing-checkbox" value="${item.en}" data-hi="${item.hi}">
                    <span class="ing-label">
                        <div>${item.hi}</div>
                        <div style="font-size:0.8em; color:#666;">${item.en}</div>
                    </span>
                `;
                grid.appendChild(label);
            });
            container.appendChild(grid);
        });
    }

    // --- 4. API & LOGIC HANDLERS ---
    
    // Initialization
    window.onload = function() {
        renderPantry();
        const savedKey = localStorage.getItem('gemini_api_key');
        if (savedKey) {
            document.getElementById('apiKeyInput').value = savedKey;
            document.getElementById('key-status').textContent = "Key found!";
        }
    };

    function toggleApi() {
        const content = document.getElementById('api-content');
        content.classList.toggle('show');
        const arrow = document.getElementById('api-arrow');
        arrow.textContent = content.classList.contains('show') ? '‚ñ≤' : '‚ñº';
    }

    function saveApiKey() {
        const key = document.getElementById('apiKeyInput').value.trim();
        if (key.length > 10) {
            localStorage.setItem('gemini_api_key', key);
            document.getElementById('key-status').textContent = "Saved!";
            setTimeout(() => toggleApi(), 1000);
        } else {
            alert("Please enter a valid API Key.");
        }
    }

    function getSelectedIngredients() {
        const checkboxes = document.querySelectorAll('.ing-checkbox:checked');
        let list = [];
        checkboxes.forEach(cb => {
            list.push(cb.value);
        });
        return list;
    }

    function scrollToResults() {
        document.getElementById('results-area').scrollIntoView({ behavior: 'smooth' });
    }

    function displayRecipes(recipes, isFallback = false) {
        const container = document.getElementById('results-area');
        container.innerHTML = '';

        if(isFallback) {
            container.innerHTML = `<div style="background:#ffebee; color:#c62828; padding:10px; border-radius:8px; margin-bottom:20px; border:1px solid #ef9a9a;">
                <strong>Offline Mode / No API Key:</strong> Showing classic recipes. Add a Google Gemini Key for AI-powered custom suggestions!
            </div>`;
        }

        recipes.forEach(dish => {
            let stepsHtml = '';
            // Handle string array or single string logic
            if (Array.isArray(dish.recipe)) {
                stepsHtml = dish.recipe.map(s => `<div class="recipe-step">${s}</div>`).join('');
            } else {
                stepsHtml = `<p>${dish.recipe}</p>`;
            }

            // Create card
            const card = document.createElement('div');
            card.className = 'recipe-card';
            card.innerHTML = `
                <div class="dish-header">
                    <div class="dish-name">${dish.name}</div>
                    <div style="font-size:1.5rem;">ü•ò</div>
                </div>
                <div class="dish-meta">
                    <span>üìç ${dish.region || 'India'}</span>
                    <span>‚è±Ô∏è ${dish.time || 'N/A'}</span>
                </div>
                
                <div style="margin-bottom:15px;">${stepsHtml}</div>
                
                ${dish.desc ? `<div class="why-it-works">üí° ${dish.desc}</div>` : ''}

                <div class="card-actions">
                    <button class="btn-small" onclick="copyRecipe(this)">üìã Copy</button>
                </div>
            `;
            container.appendChild(card);
        });
        scrollToResults();
    }

    async function generateRecipes() {
        const ingredients = getSelectedIngredients();
        
        if (ingredients.length < 3) {
            alert("Please select at least 3 ingredients (Dals, Veggies, etc) to get good suggestions! | ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 3 ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç.");
            return;
        }

        const apiKey = localStorage.getItem('gemini_api_key');
        const loader = document.getElementById('loader');
        const resultsArea = document.getElementById('results-area');

        // UI Reset
        resultsArea.innerHTML = '';
        loader.style.display = 'block';

        // Fallback if no key
        if (!apiKey) {
            setTimeout(() => {
                loader.style.display = 'none';
                displayRecipes(fallbackRecipes, true);
            }, 1500); // Fake delay for feel
            return;
        }

        // PROMPT ENGINEERING
        const promptText = `
        You are an expert Indian grandmother from a traditional joint family with 50 years of cooking experience. The user has ONLY these ingredients at home right now:
        [${ingredients.join(', ')}]

        They may or may not have salt, water, basic cooking oil/ghee. Do not assume any other ingredient.

        Suggest 5‚Äì6 authentic, delicious Indian dishes (vegetarian only) that can definitely be made with these ingredients only. 
        For each dish give:
        1. Name (Hindi Name + English Name)
        2. Region (State)
        3. Recipe: A very short array of 4-5 strings steps (Hinglish or English).
        4. Time (approx)
        5. Desc: Why it tastes great (1 sentence).
        
        Prioritize everyday ghar ka khana. Include at least 2 simple 10-min recipes.
        
        OUTPUT ONLY RAW JSON ARRAY like this:
        [{"name":"...","region":"...","recipe":["step1","step2"],"time":"...","desc":"..."}]
        Do not use Markdown formatting.
        `;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: promptText }] }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 800
                    }
                })
            });

            if (!response.ok) throw new Error("API Error");

            const data = await response.json();
            let rawText = data.candidates[0].content.parts[0].text;
            
            // Clean up Markdown if Gemini adds it (```json ... ```)
            rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
            
            const recipes = JSON.parse(rawText);
            
            loader.style.display = 'none';
            displayRecipes(recipes, false);

        } catch (error) {
            console.error(error);
            loader.style.display = 'none';
            // Fallback on error
            displayRecipes(fallbackRecipes, true);
            alert("Something went wrong with the AI connection. Showing standard recipes instead.");
        }
    }

    function copyRecipe(btn) {
        const card = btn.closest('.recipe-card');
        const text = card.innerText;
        navigator.clipboard.writeText(text).then(() => {
            const original = btn.textContent;
            btn.textContent = "Copied!";
            setTimeout(() => btn.textContent = original, 2000);
        });
    }

</script>

</body>
</html>
